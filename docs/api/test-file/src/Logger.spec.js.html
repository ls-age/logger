<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <base data-ice="baseUrl" href="../../">
  <title data-ice="title">src/Logger.spec.js | @lsage/logger API Document</title>
  <link type="text/css" rel="stylesheet" href="css/style.css">
  <link type="text/css" rel="stylesheet" href="css/prettify-tomorrow.css">
  <script src="script/prettify/prettify.js"></script>
  
  
  <script src="script/manual.js"></script>
</head>
<body class="layout-container" data-ice="rootContainer">

<header>
  <a href="./">Home</a>
  <a href="./manual/index.html" data-ice="manualHeaderLink">Manual</a>
  <a href="identifiers.html">Reference</a>
  <a href="source.html">Source</a>
  <a href="test.html" data-ice="testLink">Test</a>
  <a data-ice="repoURL" href="https://github.com/ls-age/logger" class="repo-url-github">Repository</a>
  <div class="search-box">
  <span>
    <img src="./image/search.png">
    <span class="search-input-edge"></span><input class="search-input"><span class="search-input-edge"></span>
  </span>
    <ul class="search-result"></ul>
  </div>
</header>

<nav class="navigation" data-ice="nav"><div>
  <ul>
    
  <li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/Logger.js~Logger.html">Logger</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-logger">logger</a></span></span></li>
<li data-ice="doc"><div data-ice="dirPath" class="nav-dir-path">typedef</div><span data-ice="kind" class="kind-external">E</span><span data-ice="name"><span><a href="https://nodejs.org/api/stream.html#stream_class_stream_writable">stream~Writable</a></span></span></li>
</ul>
</div>
</nav>

<div class="content" data-ice="content"><h1 data-ice="title">src/Logger.spec.js</h1>
<pre class="source-code line-number raw-source-code"><code class="prettyprint linenums" data-ice="content">import Emitter from &apos;events&apos;;
import { Transform } from &apos;stream&apos;;
import expect from &apos;unexpected&apos;;
import { spy } from &apos;sinon&apos;;
import Logger from &apos;../../src/Logger&apos;;

class NoopTransformStream extends Transform {
  _transform(chunk, enc, callback) {
    callback(null, chunk);
  }
}

/** @test {Logger} */
describe(&apos;Logger&apos;, function() {
  /** @test {Logger#constructor} */
  describe(&apos;#constructor&apos;, function() {
    it(&apos;should return an emitter&apos;, function() {
      expect(new Logger(), &apos;to be an&apos;, Emitter);
    });
    
    it(&apos;should handle types option&apos;, function() {
      const types = [&apos;first&apos;, &apos;second&apos;];
      expect((new Logger({ types }))._types, &apos;to be&apos;, types);
    });

    it(&apos;should register log methods for all types&apos;, function() {
      const logger = new Logger();

      Logger.defaultTypes.forEach(type =&gt; {
        expect(logger[type], &apos;to be defined&apos;);
        expect(logger[type], &apos;to be a&apos;, &apos;function&apos;);
      });
    });

    it(&apos;should register levels for all types&apos;, function() {
      const logger = new Logger();

      Logger.defaultTypes.forEach(type =&gt; {
        expect(logger[`LEVEL_${type.toUpperCase()}`], &apos;to be defined&apos;);
        expect(logger[`LEVEL_${type.toUpperCase()}`], &apos;to be a&apos;, &apos;number&apos;);
      });
    });
  });

  /** @test {Logger#[type]} */
  describe(&apos;#[type]&apos;, function() {
    it(&apos;should emit `type` events&apos;, function() {
      const logger = new Logger();

      return Promise.all(
        Logger.defaultTypes.map(type =&gt; new Promise((resolve, reject) =&gt; {
          logger.on(type, msg =&gt; {
            try {
              resolve(expect(msg, &apos;to contain&apos;, type));
            } catch (e) {
              reject(e);
            }
          });
          logger[type](`${type} message`);
        }))
      );
    });
  });

  /** @test {Logger#prefix} */
  describe(&apos;#prefix&apos;, function() {
    it(&apos;should return a timestamp&apos;, function() {
      expect((new Logger()).prefix, &apos;to match&apos;, /\[.*[0-9]{2}:[0-9]{2}:[0-9]{2}.*\]/);
    });
  });

  /** @test {Logger#_format} */
  describe(&apos;#_format&apos;, function() {
    it(&apos;should join string arguments&apos;, function() {
      expect((new Logger())._format([&apos;first&apos;, &apos;second&apos;]), &apos;to contain&apos;, &apos;first second&apos;);
    });

    it(&apos;should add a newline&apos;, function() {
      expect((new Logger())._format([&apos;first&apos;, &apos;second&apos;]), &apos;to end with&apos;, &apos;\n&apos;);
    });
  });

  /** @test {Logger#pipe} */
  describe(&apos;#pipe&apos;, function() {
    it(&apos;should write logs to stream&apos;, function(done) {
      const stream = new NoopTransformStream();

      const logger = new Logger()
        .pipe(stream);

      stream.on(&apos;data&apos;, msg =&gt; {
        expect(msg.toString(), &apos;to contain&apos;, &apos;Test&apos;);
        done();
      });

      logger.info(&apos;Test&apos;);
    });

    it(&apos;should remove listeners on close&apos;, function() {
      const stream = new NoopTransformStream();
      const logger = new Logger()
        .pipe(stream);

      stream.end();

      Logger.defaultTypes.forEach(type =&gt; {
        expect(logger.listenerCount(type), &apos;to be&apos;, 0);
      });
    });

    it(&apos;should handle logLevel option&apos;, function() {
      const onData = spy();
      const stream = new NoopTransformStream()
        .on(&apos;data&apos;, onData);
      const logger = new Logger()
        .pipe(stream, { logLevel: 2 });

      logger.info(&apos;Test info&apos;);
      logger.warn(&apos;Test warning&apos;);

      expect(onData.calledOnce, &apos;to be&apos;, true);
      expect(onData.lastCall.args[0].toString(), &apos;to contain&apos;, &apos;Test warning&apos;);
    });
  });
});
</code></pre>

</div>

<footer class="footer">
  Generated by <a href="https://esdoc.org">ESDoc<span data-ice="esdocVersion">(0.5.2)</span><img src="./image/esdoc-logo-mini-black.png"></a>
</footer>

<script src="script/search_index.js"></script>
<script src="script/search.js"></script>
<script src="script/pretty-print.js"></script>
<script src="script/inherited-summary.js"></script>
<script src="script/test-summary.js"></script>
<script src="script/inner-link.js"></script>
<script src="script/patch-for-local.js"></script>
</body>
</html>
